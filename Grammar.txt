Statements <- Sep*, Statement, (Sep+, Statement)*, Sep*

Statement <- Conditional

Conditional <- TernaryIf, {("if" | "unless"), NewLine*, Statement}

Expression <- TernaryIf

TernaryIf <- Arithmetic, {"?", NewLine*, TernaryIf, ":", NewLine*, TernaryIf}

Arithmetic <- Term, {TermOp, NewLine*, Term}

TermOp <- "+"
	| "-"

Term <- Unary, (FactorOp, NewLine*, Unary)*

FactorOp <- "*"
	| "/"
	
Unary <- {("+" | "-"), NewLine*}, LookupChain

LookupChain <- Factor, Lookup(Call)*, {Lookup(Identifier), AssignTail}

Lookup(Type) <- "::", NewLine*, Type
	| ".", NewLine*, Type
	| "[", NewLine*, Expression, NewLine*, "]"

Factor <- Number
	| String
	| InterpolatedString
	| Variable
	| Call
	| Assigment
	| If
	| Case
	| Unless
	| Class
	| Method
	| Yield
	| "(", Expressions, ")"

Class <- "class", Identifier, Sep, Statements, "end"

Method <- "def", Identifier, ({MethodParameters}, Sep | "(", MethodParameters, ")"), Statements, "end"

MethodParameters <- MethodParameter, (",", MethodParameter)*

MethodParameter <- {"&" | "*"}, Identifier

Case <- "case", (When+ {Else} | Else), "end"

When <- "when", Expression, ThenSep

If <- "if", Expression, ThenSep, Statements, {"elsif", Statements}*, {Else}, "end"

Else <- "else", Statements

Unless <- "unless", Expression, ThenSep, Statements, "end"

Assigment <- Variable, AssignTail

AssignTail <- AssignOp, NewLine*, Expression

AssignOp <- "="
	| "+="
	| "-="
	| "*="
	| "/="

Call <- Identifier, {Arguments | "(", Arguments, ")"}, {Block}

Yield  <- {Arguments | "(", Arguments, ")"}

Block <- "{", {BlockParameters}, Statements, "}"
	| "do", {BlockParameters}, Statements, "end"

BlockParameters <- "|", MethodParameters, "|"

Arguments <- Expression, (",", Expression)*

Variable <- Identifier

ThenSep <- "then"
	| Sep
	| ":"

Sep <- NewLine+
	| ";"

InterpolatedString = StringStart, Statements, (StringContinue, Statements)* StringEnd

# Tokens from lexer

Identifier
Number
NewLine
String
StringStart
StringContinue
StringEnd